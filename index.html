<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Sustainable Eateries - Global Zero Waste Map</title>
    
    <meta name="description" content="Find zero-waste and sustainable eateries near you. A crowdsourced global map of eco-friendly restaurants, rated by the community.">
    <meta name="keywords" content="sustainable food, zero waste restaurant, eco friendly dining, plastic free, sustainability map">
    <meta name="author" content="Sustainable Eateries Community">
    <meta property="og:title" content="Sustainable Eateries Map">
    <meta property="og:description" content="Discover and rate eco-friendly eateries. Help reduce single-use plastics.">
    <meta property="og:url" content="https://atgauravjain.github.io/sustainable-eateries/">
    <meta property="og:type" content="website">

    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="preconnect" href="https://unpkg.com">
    <link rel="preconnect" href="https://maps.googleapis.com">
    
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster/dist/MarkerCluster.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster/dist/MarkerCluster.Default.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/Leaflet.awesome-markers/2.0.2/leaflet.awesome-markers.css">
    <link rel="stylesheet" href="https://code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css">
    <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />

    <style>
        /* --- Base Layout --- */
        body { font-family: Arial, sans-serif; padding-top: 0px; padding-bottom: 0px; }
        .well { background: #f5f5f5; border: 0px solid #e3e3e3; box-shadow: none; }
        
        /* --- Map Canvas --- */
        #mymap { 
            height: 580px; 
            width: 100%; 
            border: 1px solid #ccc; 
            border-radius: 4px; 
            z-index: 1; 
        }
        
        /* --- Mobile Optimization --- */
        @media (max-width: 767px) {
            #mymap { height: 400px; }
            h1 { font-size: 26px; margin-top: 10px; }
            h3 { font-size: 16px; margin-top: 5px;}
        }

        /* --- Vertical Toolbar (Left Side) --- */
        .map-toolbar {
            background: white;
            border: 2px solid rgba(0,0,0,0.2);
            border-radius: 4px;
            display: flex;
            flex-direction: column;
            /* background-clip: padding-box;
            box-shadow: 0 1px 5px rgba(0,0,0,0.65); */
            margin-left: 10px;
            margin-top: 10px;
            position: relative; /* Context for popup */
        }

        .tool-btn {
            width: 34px;
            height: 34px;
            line-height: 34px; 
            text-align: center;
            background-color: #fff;
            color: #333;
            border-bottom: 1px solid #ccc;
            cursor: pointer;
            font-size: 18px;
            transition: all 0.2s;
        }
        .tool-btn:first-child { border-top-left-radius: 4px; border-top-right-radius: 4px; }
        .tool-btn:last-child { border-bottom: none; border-bottom-left-radius: 4px; border-bottom-right-radius: 4px; }
        .tool-btn:hover { background-color: #f4f4f4; color: #000; }
        
        .ion-plus, .ion-minus { font-size: 16px; font-weight: bold; }

        /* --- Search Pop-out Container (Single Cell Style) --- */
        #search-container-popup {
            position: absolute;
            left: 36px; /* Directly next to the toolbar border */
            top: 105px; /* Aligns exactly with the 4th button */
            z-index: 9999; 
            display: none; 
            background: white;
            padding: 0; /* Remove padding for seamless look */
            border-radius: 0 4px 4px 0; /* Rounded only on right side */
            box-shadow: 2px 1px 5px rgba(0,0,0,0.3);
            min-width: 220px;
            height: 34px; /* Match button height */
            border: 1px solid #aaa;
            border-left: none; /* Merge with button */
        }

        /* --- Select2 Customization --- */
        .select2-container { 
            width: 100% !important; 
            height: 100%;
        }
        .select2-selection {
            border: none !important; /* Remove internal border */
            height: 32px !important; /* Fit container */
            border-radius: 0 4px 4px 0 !important;
            background-color: transparent !important;
        }
        .select2-selection__rendered {
            line-height: 32px !important;
        }
        .select2-selection__arrow {
            height: 32px !important;
        }
        .select2-dropdown { 
            z-index: 10000; 
            border: 1px solid #aaa;
            margin-top: 1px;
        }
        
        /* Marker Cluster Colors */
        .marker-cluster-small { background-color: rgba(181, 226, 140, 0.6); }
        .marker-cluster-small div { background-color: rgba(110, 204, 57, 0.6); }
        .marker-cluster-medium { background-color: rgba(241, 211, 87, 0.6); }
        .marker-cluster-medium div { background-color: rgba(240, 194, 12, 0.6); }
        .marker-cluster-large { background-color: rgba(253, 156, 115, 0.6); }
        .marker-cluster-large div { background-color: rgba(241, 128, 23, 0.6); }
    </style>
    
    <script src="https://www.google.com/recaptcha/api.js" async defer></script>
</head>
<body>

<div class="container"> 
    
    <header class="text-center">
        <h1>Sustainable Eateries</h1>
        <h3>A crowdsourced database to capture how eco-friendly eateries are around the globe</h3>

        <img src="images/sustainable_eateries.webp" 
             alt="Collage showing sustainable vs non-sustainable food packaging" 
             class="img-responsive center-block" 
             style="margin-top: 10px; width: 100%;">
    </header>
    <hr>

    <main class="row">
        <aside class="col-sm-4">
            <div class="well">
                <h4>How sustainable was the eatery you visited?</h4>
                
                <div class="form-group">
                    <label for="EateryAddress">Enter Eatery Name:</label>
                    <input type="text" class="form-control" id="EateryAddress" placeholder="Start typing address..." autocomplete="off">
                </div>

                <div class="form-group">
                    <label>Choose a rating based on services:</label>
                    <div class="radio"><label><input type="radio" name="rating" value="0"> 0: Dine-in or takeaway: All single-use plastics</label></div>
                    <div class="radio"><label><input type="radio" name="rating" value="1"> 1: Dine-in or takeaway: Mix of single-use plastics + natural disposables</label></div>
                    <div class="radio"><label><input type="radio" name="rating" value="2"> 2: Dine-in or takeaway: All natural disposables</label></div>
                    <div class="radio"><label><input type="radio" name="rating" value="3"> 3: Dine-in: No disposables + takeaway: Mostly single-use plastics</label></div>
                    <div class="radio"><label><input type="radio" name="rating" value="4"> 4: Dine-in: No disposables + takeaway: All natural disposables or no disposables + waste segregation</label></div>
                    <div class="radio"><label><input type="radio" name="rating" value="5"> 5: All in 4 + signage for zero waste awareness + responsible handling of food waste (composted or sent to other places for consumption)</label></div>
                </div>

                <div class="alert alert-info" style="font-size: 0.9em; padding: 10px; color: #31708f; background-color: #d9edf7; border-color: #bce8f1;">
                    <p>Single-use plastics: Cutlery/packaging/containers made of plastic/polystyrene that are intended for a single use</p>
                    <p>Natural disposables are single usage cutlery/packaging/containers made from natural materials, such as sugarcane, paper, bamboo leaves of palm or areca nut..
                </div></p>

                <div class="form-group">
                    <label for="Comments">Comments, suggestions, feedback (if any)</label>
                    <input type="text" class="form-control" id="Comments">
                </div>
                <div class="form-group">
                    <label for="Email">Would you like to collaborate on this project? Share your email to receive occasional feedback/update emails</label>
                    <input type="email" class="form-control" id="Email">
                </div>

                <div style="margin-bottom: 15px;">
                     <div class="g-recaptcha" data-sitekey="6LeS0TQsAAAAAG9AWi_PH53Wr6kd8TLY6soeKk-T"></div>
                </div>

                <button id="submitBtn" class="btn btn-primary btn-block" onclick="submitData()">Submit Entry</button>
                <div id="statusMsg" style="margin-top:10px; font-weight:bold;"></div>
            </div>
        </aside>

        <section class="col-sm-8">
            <ul class="nav nav-tabs">
                <li class="active"><a data-toggle="tab" href="#viz">Data Visualization</a></li>
                <li><a data-toggle="tab" href="#knowmore">I want to know more</a></li>
                <li><a data-toggle="tab" href="#domore">I want to do more</a></li>
            </ul>

            <div class="tab-content">
                <div id="viz" class="tab-pane fade in active">
                    <br>
                    <p class="lead" style="font-size: 16px;">In the times when most human activities are motivated by immediate economic outcomes.. and the times when we are facing the wrath of that ideology in the air, water, land pollution in our surroundings, this is a tiny effort to document | appreciate sustainable measures relevant to eateries around the world!</p>
                    <p class="lead" style="font-size: 16px;">Whether it is a humble roadside food cart that refuses to serve in single-use plastics, or it is a roaring zerowaste restaurant, bring it all in, as each effort counts. Also vice versa, so wherever in the spectrum the eatery you visited lies, bring it on.</p>
                    <p class="lead" style="font-size: 16px;">Search the existing data for suggestions if you are in a new place, or add an entry to the dataset of the eatery you just visited. üåø</p>
                    <div id="mymap"></div>
                </div>

                <div id="knowmore" class="tab-pane fade">
                    <p><br /></p>
                    <p><strong>Litter Litter Everywhere</strong>: Less than 10% of plastic
                    gets recycled globally <a href="https://www.nationalgeographic.org/article/whopping-91-percent-plastic-isnt-recycled/">[1]</a>.
                    Everything else is around us, in the land or in the oceans, as harmful
                    litter.</p>
                    <p><img src="images/plastic_litter_on_streets.webp" title="Plastic waste littered on the streets" alt="Plastic waste littered on the streets" width="70%" style="display: block; margin: auto;" /></p>
                    <p><strong>Huge carbon footprint</strong>: Most of the plastic (~99%) is
                    made from chemicals sourced from fossil fuel manufacturing and
                    contributes to emission of greenhouse gases at each stage of its
                    lifecycle: extraction, transport, refining, managing waste and impact on
                    air, water, and land when disposed of <a href="https://www.ciel.org/wp-content/uploads/2019/05/Plastic-and-Climate-Executive-Summary-2019.pdf">[2]</a>.</p>
                    <p><strong>Air Pollution</strong>: More than 40% of the waste around the
                    globe is simply incinerated <a href="https://news.ucar.edu/12239/trash-burning-worldwide-significantly-worsens-air-pollution">[3]</a>.
                    When plastic is burnt, it results in emission of toxic gases such as
                    dioxins, furans, mercury and polychlorinated biphenyls (BCP) polluting
                    the air and posing a major health risk to all life. <a href="https://www.unenvironment.org/news-and-stories/story/plastic-bag-bans-can-help-reduce-toxic-fumes">[4]</a></p>
                    <p><strong>Health impact</strong>: Plastic is a health hazard at every
                    stage of its lifecycle:</p>
                    <ul>
                    <li><p><strong>Extraction</strong>: Chemicals used for fracking fossil
                    fuel to generate the raw material for plastic are known to have major
                    health impacts including cancer, neurological, developmental,
                    reproductive and immunity disorders.</p></li>
                    <li><p><strong>Manufacturing</strong>: Processes to convert fossil fuel
                    to plastic release carcinogens and other toxins in the air.</p></li>
                    <li><p><strong>Consumer Usage</strong>: Use of plastic products leads to
                    ingestion of microplastics and other toxins causing carcinogenic,
                    developmental and endocrine-disrupting impacts.</p></li>
                    <li><p><strong>Waste Management:</strong> All plastic waste management
                    technologies (including incineration, co-incineration, gasification, and
                    pyrolysis) result in the release of toxic metals, organic substances
                    (dioxins and furans), acid gases to the air, water, and soils and
                    impacting the health of workers and those living in the surrounding
                    areas.</p></li>
                    <li><p><strong>Waste in the Environment</strong>: Once plastic reaches
                    the environment in the form of macro- or microplastics, it contaminates
                    and accumulates in food chains through agricultural soils, terrestrial
                    and aquatic food chains, and the water supply. This environmental
                    plastic can easily leach toxic additives or concentrate toxins already
                    in the environment, making them bioavailable again for direct or
                    indirect human exposure. <a href="https://www.ciel.org/project-update/plastic-and-human-health-a-lifecycle-approach-to-plastic-pollution/">[5]</a></p></li>
                    </ul>
                    <div class="figure" style="text-align: center">
                    <img src="images/plastic_injested_by_an_albatross_chick.webp" alt="Plastic found in stomach contents of a dead albatross chick" width="35%" />
                    <p class="caption">
                    Plastic found in stomach contents of a dead albatross chick [Image
                    Courtesy: Open.edu]
                    </p>
                    </div>
                    <blockquote>
                    <p>Plastic adds to toxic litter everywhere on our planet, has a huge
                    carbon footprint and tremendous health hazards during each stage of its
                    lifecycle. Single usage of the material for minor conveniences of human
                    living is not worth the huge negative impact of the material on other
                    species and the planet. üåè</p>
                    </blockquote>
                </div>

                <div id="domore" class="tab-pane fade">
                    <p><br /></p>
                    <ul>
                    <li><p>Observe the type of waste eateries around you most typically
                    generate.</p></li>
                    <li><p>If you find a low waste eatery around you, appreciate them for
                    what they do, that added boost will go a long way.</p></li>
                    <li><p>Eat fresh at home, as much as you can. Nothing beats the
                    freshness, health, taste or eco-friendliness of home food.</p></li>
                    <li><p>If you cannot cook and eat, then dine-in at a nearby eatery
                    instead of ordering a takeout.</p></li>
                    <li><p>If takeout is a must, then take your own containers
                    along.</p></li>
                    <li><p>If none of the above, then try to order food which can be packed
                    in natural biodegradable materials, and insist on that being the case.
                    Say a firm no to disposable plastic cutlery.</p></li>
                    <li><p>Yet if none of the above, then just wash the disposables, and try
                    to reuse them. Or keep them in your sight to avoid more waste going
                    forward.</p></li>
                    </ul>
                    <p><br /> <br /> üçÄ This is an open-source project. If you would like to
                    collaborate on the work, reach out on the project‚Äôs github <a href="https://github.com/Nirzaree/ShinyWebAppWithFormAndLeafletMap">page</a>.
                    If you have any feedback or comments, then say hi to Nirzaree at
                    nirzaree[dot]svnit[at]gmail[dot]com üçÄ</p>
                </div>
            </div>
            
            <br>
            <div id="wcb" class="carbonbadge"></div>
        </section>
    </main>
   <!-- <footer class="text-center text-muted" style="margin-top: 20px;">
        <p><small>&copy; Sustainable Eateries. Data provided by community.</small></p>
    </footer>     -->
 
</div>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
<script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
<script src="https://unpkg.com/leaflet.markercluster/dist/leaflet.markercluster.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/Leaflet.awesome-markers/2.0.2/leaflet.awesome-markers.min.js"></script>
<script src="https://unpkg.com/website-carbon-badges@1.1.1/b.min.js" defer></script>
<script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>

<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDaRSuTtnn4Bg1WnAubG1b_gbK91KRAFK4&libraries=places&callback=initAutocomplete" async defer></script>

<script>
    // --- SETTINGS ---
    const APP_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbxh4beD3IFkV1e7CGpQVnuXakUq6sFkcbSiOWR0NGUI8VVRPi_umk0LZCxKUdyWhwBHmg/exec"; 

// --- 1. LOAD EXTERNAL HTML FILES ---
    function loadExternalContent() {
        fetch('Iwanttoknowmore.html')
            .then(r => r.ok ? r.text() : "Error loading file.")
            .then(html => document.getElementById('knowmore-content').innerHTML = html);
        fetch('Iwanttodomore.html')
            .then(r => r.ok ? r.text() : "Error loading file.")
            .then(html => document.getElementById('domore-content').innerHTML = html);
    }
    window.onload = loadExternalContent;

    // --- 2. PLACES AUTOCOMPLETE ---
    let selectedPlace = {};
    function initAutocomplete() {
        if (!google || !google.maps || !google.maps.places) return;
        var input = document.getElementById('EateryAddress');
        var autocomplete = new google.maps.places.Autocomplete(input, {types: ['establishment']});
        autocomplete.setFields(['formatted_address', 'geometry', 'name']);
        autocomplete.addListener('place_changed', function() {
            var place = autocomplete.getPlace();
            if (!place.geometry) { input.classList.add('alert-danger'); return; } 
            else { input.classList.remove('alert-danger'); }
            selectedPlace = {
                name: place.name,
                address: place.formatted_address,
                lat: place.geometry.location.lat(),
                lng: place.geometry.location.lng()
            };
        });
    }

    // --- 3. SUBMIT DATA ---
    function submitData() {
        const ratingInput = document.querySelector('input[name="rating"]:checked');
        const comments = document.getElementById('Comments').value;
        const email = document.getElementById('Email').value;
        const msg = document.getElementById('statusMsg');
        const btn = document.getElementById('submitBtn');
        msg.innerHTML = "";

        if (!selectedPlace.lat) { alert("Please select an eatery from the dropdown."); return; }
        if (!ratingInput) { alert("Please choose a rating."); return; }
        
        const captchaToken = grecaptcha.getResponse();
        if (captchaToken.length === 0) { alert("Please verify you are human."); return; }

        btn.disabled = true; btn.innerText = "Submitting...";

        const payload = {
            EateryName: selectedPlace.name,
            EateryAddress: selectedPlace.address,
            Lat: selectedPlace.lat,
            Lng: selectedPlace.lng,
            Sustainabilityrating: ratingInput.value,
            Comments: comments,
            Email: email,
            captchaToken: captchaToken 
        };

        fetch(APP_SCRIPT_URL, {
            method: 'POST', mode: 'no-cors', 
            headers: { 'Content-Type': 'text/plain;charset=utf-8' },
            body: JSON.stringify(payload)
        }).then(() => {
            msg.innerHTML = '<span class="text-success">Entry submitted! Refreshing... üçÄ</span>';
            setTimeout(() => location.reload(), 3000);
        }).catch(err => {
            console.error(err);
            msg.innerHTML = '<span class="text-danger">Error. Try again.</span>';
            btn.disabled = false; btn.innerText = "Submit Entry";
        });
    }

    // --- 4. MAP & TOOLBAR LOGIC ---
    const INITIAL_COORDS = [20, 0];
    const INITIAL_ZOOM = 2;

    var map = L.map('mymap', { zoomControl: false }).setView(INITIAL_COORDS, INITIAL_ZOOM);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', { attribution: '&copy; OpenStreetMap' }).addTo(map);

    // -- Helper to close search --
    function closeSearchPopup() {
        document.getElementById('search-container-popup').style.display = 'none';
        $('#eaterySearch').select2('close');
    }

    // -- Custom Toolbar --
    L.Control.CustomToolbar = L.Control.extend({
        options: { position: 'topleft' },
        onAdd: function(map) {
            var container = L.DomUtil.create('div', 'map-toolbar');
            container.id = 'map-toolbar-container'; 
            L.DomEvent.disableClickPropagation(container);

            var createBtn = function(iconClass, title, onClick) {
                var btn = L.DomUtil.create('div', 'tool-btn', container);
                btn.innerHTML = '<i class="' + iconClass + '"></i>';
                btn.title = title;
                btn.onclick = onClick;
                return btn;
            };

            // 1. Zoom In
            createBtn('ion-plus', 'Zoom In', function() { closeSearchPopup(); map.zoomIn(); });
            // 2. Zoom Out
            createBtn('ion-minus', 'Zoom Out', function() { closeSearchPopup(); map.zoomOut(); });
            // 3. Reset
            createBtn('ion-refresh', 'Reset View', function() { closeSearchPopup(); map.setView(INITIAL_COORDS, INITIAL_ZOOM); });

            // 4. Search (Toggle)
            var searchBtn = createBtn('ion-search', 'Search', function(e) {
                var popup = document.getElementById('search-container-popup');
                if (popup.style.display === 'none' || popup.style.display === '') {
                    popup.style.display = 'block';
                    setTimeout(function(){ $('#eaterySearch').select2('open'); }, 100);
                } else {
                    popup.style.display = 'none';
                }
                e.stopPropagation(); 
            });
            searchBtn.id = 'search-toggle-btn';

            // 5. Near Me
            createBtn('ion-android-locate', 'Near Me', function() { 
                closeSearchPopup(); 
                map.locate({setView: true, maxZoom: 16, enableHighAccuracy: true}); 
            });

            // -- Search Popup Container --
            var searchPopup = L.DomUtil.create('div', '', container);
            searchPopup.id = 'search-container-popup';
            // Simple Dropdown inside
            searchPopup.innerHTML = '<select id="eaterySearch"><option></option></select>';
            L.DomEvent.disableClickPropagation(searchPopup);

            return container;
        }
    });
    map.addControl(new L.Control.CustomToolbar());

    // -- Click outside to close --
    document.addEventListener('click', function(event) {
        var popup = document.getElementById('search-container-popup');
        var btn = document.getElementById('search-toggle-btn');
        var select2Open = document.querySelector('.select2-container--open');

        if (popup && popup.style.display === 'block') {
            if (!popup.contains(event.target) && !btn.contains(event.target) && !select2Open) {
                closeSearchPopup();
            }
        }
    });

    // -- Init Select2 with custom language override --
    $(document).ready(function() {
        $('#eaterySearch').select2({
            placeholder: "Type to search...",
            allowClear: true,
            minimumInputLength: 1, // Require typing
            dropdownParent: $('#search-container-popup'),
            language: {
                // Remove the "Please enter 1 or more characters" message
                inputTooShort: function () {
                    return ''; 
                }
            }
        });
    });

    // --- 5. FETCH DATA & MARKERS ---
    var markers = L.markerClusterGroup({ disableClusteringAtZoom: 15 });
    var markerMap = {}; 

    fetch(APP_SCRIPT_URL)
    .then(res => res.json())
    .then(data => {
        if(!Array.isArray(data)) return;
        data.sort((a, b) => a.EateryName.localeCompare(b.EateryName));

        data.forEach((row, index) => {
            let lat = parseFloat(row.Lat);
            let lng = parseFloat(row.Lng);

            if(!isNaN(lat) && !isNaN(lng)) {
                let color = 'red';
                let r = parseFloat(row.MeanSustainabilityrating);
                if(r >= 4) color = 'green';
                else if(r >= 3) color = 'orange';

                let icon = L.AwesomeMarkers.icon({
                    icon: 'leaf', prefix: 'ion', markerColor: color, iconColor: 'white'
                });

                let marker = L.marker([lat, lng], {icon: icon});
                marker.bindPopup(`<strong>${row.EateryName}</strong><br>Rating: ${Number(r).toFixed(1)}/5`);
                markers.addLayer(marker);

                var optionId = "marker_" + index;
                markerMap[optionId] = marker;
                var newOption = new Option(row.EateryName, optionId, false, false);
                $('#eaterySearch').append(newOption);
            }
        });
        map.addLayer(markers);
    })
    .catch(e => console.log("Map Error:", e));

    // Handle Selection
    $('#eaterySearch').on('select2:select', function (e) {
        var selectedId = e.params.data.id;
        var targetMarker = markerMap[selectedId];
        if (targetMarker) {
            map.setView(targetMarker.getLatLng(), 18);
            markers.zoomToShowLayer(targetMarker, function() {
                targetMarker.openPopup();
            });
            closeSearchPopup();
        }
    });

</script>
</body>
</html>